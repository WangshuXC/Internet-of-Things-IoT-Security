# Introduction

这个项目是 《物联网安全》这门课程的第三次实验

实验要求如下：

1. **基于MQTT协议，编程模拟实现智能家居应用场景下用户控制物联网设备的原型程序。**

**原型系统至少包含如下功能：**

支持至少2个用户，至少3个物联网设备同时在线。

> 注：
>
> 1. 物联网设备硬件功能仅用代码模拟即可，如输出“on”表示灯打开
>
> 2. 在不同的实体计算机（或虚拟机、手机）上部署MQTT服务器与MQTT客户端
>
> 3. 利用密码学知识与工具，查询相关资料，使该系统能抵御指令重放攻击。
>
> 4. 模拟核心的智能家居功能：用户操控设备、查看设备状态、设备绑定（可选功能：设备分享、设备注册）



2. **从攻击者的视角对本组的原型系统实现开展安全评估**

> 提示：请考虑不同的威胁模型，即不同的应用场景与敌手能力。例如，攻击者可能合法购买一个同款设备逆向分析，甚至可能共享使用过目标设备。

# How to use?

## 安装Emqx

1. 在命令行工具中输入如下命令，下载 zip 文件。

   `wget https://www.emqx.com/zh/downloads/broker/5.3.0/emqx-5.3.0-macos11-amd64.zip`

2. 通过以下命令安装 EMQX。

   `mkdir -p emqx && unzip emqx-5.3.0-windows-amd64.zip -d emqx`

3. 运行以下命令启动 EMQX。

   `./emqx/bin/emqx start`

   如果出现以下命令即为启动成功

   ```bash
   PS -\mqtt> ./emqx/bin/emqx start
   EMQX_NODE__DB_ROLE [node.role]: core
   EMQX_NODE__DB_BACKEND [node.db_backend]: mnesia
   ```

4. 现在可通过浏览器访问 http://localhost:18083/（localhost 可替换为您的实际 IP 地址）以访问 EMQX Dashboard 管理控制台，进行设备连接与相关指标监控管理。
   - 默认用户名：`admin`  
   - 默认密码：`public`

5. 运行以下命令停止 EMQX。

   `./emqx/bin/emqx stop`



## Emqx设置

在左侧菜单栏中可以看到六项可展开栏目，分别为 监控、**访问控制**、集成、管理、问题分析、系统设置

1. 前往 **访问控制 ** -  **客户端认证**，点击右侧绿色的创建按钮
2. 在认证方式中选择 **Password-Based** ，数据源推荐选择 **内置数据库** ，配置参数**默认**即可
3. 创建成功后在 **访问控制 ** -  **客户端认证**  -  **操作**   -  **用户管理 **中添加物联网设备的和用户端的账号（用户名和密码请看代码定义）



## Python文件

建议先启动多个物联网设备端，再开启用户控制端

随后按照用户控制端的控制台输出进行操作即可
